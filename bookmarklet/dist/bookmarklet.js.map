{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./bookmarklet/bookmarklet.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_","methods","cacheUserDetailUuid","cacheTaskIdAndProjectId","Map","xhrGet","url","xhr","method","json","request","XMLHttpRequest","Promise","resolve","reject","onreadystatechange","readyState","status","responseText","statusText","open","setRequestHeader","send","createContent","idCss","idHtml","clear","forEach","id","document","querySelectorAll","element","parentNode","removeChild","link","createElement","rel","type","href","Date","getTime","media","onload","head","appendChild","then","idInput","idSelectType","idButtonBook","idButtonClear","idButtonClose","idLoader","dummy","innerHTML","body","querySelector","setTimeout","getElementById","focus","addEventListener","e","preventDefault","content","originalEvent","clipboardData","getData","execCommand","onclick","input","span","string","innerText","trim","length","setEnabled","isEnabled","disabled","contentEditable","style","visibility","selectType","timesheetTypeUuid","options","selectedIndex","linePrevious","lineArray","split","synchronizedLineProcessor","statusOfPreviousLine","scrollTop","scrollHeight","shift","line","callback","properties","isNaN","charAt","stringDate","substr","stringTimeBegin","stringTimeEnd","indexOfPipe","indexOf","stringJiraKey","substring","stringComment","integerYearCurrent","getFullYear","integerYear","parseInt","integerMonth","integerDay","date","setFullYear","getMonth","getDate","isInvaliDigit","stringTime","isInvalidHour","integerHour","isInvalidMinute","integerMinute","integerHourBegin","integerHourEnd","integerMinuteBegin","integerMinuteEnd","jiraKey","APP_BeginTime","APP_EndTime","APP_Description","nextStep","APP_UserDetailUuid","response","JSON","parse","console","log","cache","APP_TaskUuid","APP_ProjectUuid","xhrPost","stringify","USR_TimesheetTypeUuid","catch","error","createEntity","has","set","queryTaskIdAndProjectIdForJiraKey","checkIfEntityWithEqualBeginOrEndTimeAlreadyExists","useruuid","queryUserId","checkLineAndParseProperties","refreshButton","click","onkeydown","event","window","keyCode","undefined","location","origin","main"],"mappings":"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","file":"bookmarklet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import './bookmarklet.css';\n\n// console.clear();\n\nfunction main() {\n\tif (window['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING']) {\n\t\tconsole.log('ERROR: bookmarklet is already running');\n\t\treturn; // https://stackoverflow.com/questions/550574/how-to-terminate-the-script-in-javascript\n\t}\n\twindow['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING'] = true; // global scope var, https://stackoverflow.com/questions/9521298/verify-external-script-is-loaded\n\n\tconsole.log('bookmarklet called');\n\n\tconst url = 'https://dynatrace.timecockpit.com';\n\n\tif (window.location.origin !== url) {\n\t\tconst dummy = document.createElement('dummy');\n\t\tdummy.innerHTML = '\\\n\t\t\t<div style=\"position: fixed; top: 0; bottom: 0; left: 0; right: 0; z-index: 999; background-color: rgba(0, 0, 0, 0.66); display: grid;\">\\\n\t\t\t\t<div style=\"margin: auto; padding: 24px; box-sizing: border-box; font-size: 24px; background-color: yellow; border-radius: 4px; font-family: Roboto, \\'Segoe UI\\', BlinkMacSystemFont, system-ui, -apple-system, Arial, Helvetica, sans-serif;\">\\\n\t\t\t\t\t...redirecting to ' + url + '. Run the bookmarklet again after the site loaded.\\\n\t\t\t\t</div>\\\n\t\t\t</div>';\n\t\tdocument.body.appendChild(dummy.querySelector('div')); // https://developer.mozilla.org/de/docs/Web/API/Document/body and https://stackoverflow.com/questions/9614932/best-way-to-create-large-static-dom-elements-in-javascript\n\n\t\twindow.setTimeout(function () {\n\t\t\t// https://stackoverflow.com/questions/18048338/how-can-i-execute-a-script-after-calling-window-location-href\n\t\t\t// window.onload = function () { ... cannot be performed after the redirect\n\t\t\twindow.location.href = url;\n\t\t}, 1000);\n\n\t} else {\n\t\tif (document.readyState && document.readyState === 'complete') {\n\t\t\t_.createContent();\n\t\t} else {\n\t\t\twindow['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING'] = false;\n\t\t}\n\t}\n}\n\nvar _ = (function () { // https://gomakethings.com/creating-your-own-vanilla-js-helper-library-like-lodash-and-underscore.js/\n\t'use strict';\n\tconst methods: any = {};\n\n\t// caches\n\tlet cacheUserDetailUuid;\n\tconst cacheTaskIdAndProjectId = new Map();\n\n\tconst statusOfPreviousLineDone = 'done';\n\n\tmethods.createContent = function () {\n\t\tconst idCss = 'com_kamilsarelo_dynatrace_timetracking_css';\n\t\tconst idHtml = 'com_kamilsarelo_dynatrace_timetracking_html'; // https://stackoverflow.com/questions/6028211/what-is-the-standard-naming-convention-for-html-css-ids-and-classes/37797488#37797488\n\n\t\t// clear previous instances\n\t\tfunction clear() { // or:  const clear = function() {\n\t\t\t[idHtml, idCss].forEach(function (id) {\n\t\t\t\tdocument.querySelectorAll('#' + id).forEach(function (element) {\n\t\t\t\t\telement.parentNode.removeChild(element); //https://stackoverflow.com/questions/8830839/javascript-dom-remove-element/8830882\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tclear();\n\n\t\t(function () { // or: function loadCss() { | const loadCss = function() {\n\t\t\treturn new Promise(function (resolve, reject) { // https://stackoverflow.com/questions/574944/how-to-load-up-css-files-using-javascript/51183077#51183077\n\n\t\t\t\t// CSS\n\n\t\t\t\tconst link = document.createElement('link');\n\t\t\t\tlink.id = idCss;\n\t\t\t\tlink.rel = 'stylesheet';\n\t\t\t\tlink.type = 'text/css';\n\t\t\t\t// link.href = 'https://localhost/bookmarklet.css';\n\t\t\t\t// link.href = 'https://cdn.jsdelivr.net/gh/kamilsarelo/timetracking/bookmarklet/bookmarklet.css';\n\t\t\t\tlink.href = 'https://christian-fischer.github.io/com.dynatrace.timetracking.bookmarklet.css?q=' + (new Date).getTime();\n\t\t\t\tlink.media = 'all';\n\t\t\t\tlink.onload = function () { // https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onload and https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick/6348533#6348533\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\tdocument.head.appendChild(link); // https://developer.mozilla.org/de/docs/Web/API/Document/head\n\t\t\t});\n\t\t})() // anonymous function call: https://stackoverflow.com/questions/7498361/defining-and-calling-function-in-one-step\n\t\t\t.then(function () { // or: // loadCss().then(function () {\n\n\t\t\t\t// HTML\n\n\t\t\t\tconst idContent = 'com_kamilsarelo_dynatrace_timetracking_content';\n\t\t\t\tconst idHeader = 'com_kamilsarelo_dynatrace_timetracking_header';\n\t\t\t\tconst idMain = 'com_kamilsarelo_dynatrace_timetracking_main';\n\t\t\t\tconst idInput = 'com_kamilsarelo_dynatrace_timetracking_input';\n\t\t\t\tconst idFooter = 'com_kamilsarelo_dynatrace_timetracking_footer';\n\t\t\t\tconst idFooterLeft = 'com_kamilsarelo_dynatrace_timetracking_footer_left';\n\t\t\t\tconst idFooterRight = 'com_kamilsarelo_dynatrace_timetracking_footer_right';\n\t\t\t\tconst idSelectType = 'com_kamilsarelo_dynatrace_timetracking_select_type';\n\t\t\t\tconst idButtonBook = 'com_kamilsarelo_dynatrace_timetracking_action_book';\n\t\t\t\tconst idButtonClear = 'com_kamilsarelo_dynatrace_timetracking_action_clear';\n\t\t\t\tconst idButtonClose = 'com_kamilsarelo_dynatrace_timetracking_action_close';\n\t\t\t\tconst idLoader = 'com_kamilsarelo_dynatrace_timetracking_loader';\n\n\t\t\t\tconst dummy = document.createElement('dummy');\n\t\t\t\tdummy.innerHTML = '\\\n\t\t\t\t\t<div id=\"' + idHtml + '\">\\\n\t\t\t\t\t\t<div id=\"' + idContent + '\">\\\n\t\t\t\t\t\t\t<div id=\"' + idHeader + '\">\\\n\t\t\t\t\t\t\t\t<select id=\"' + idSelectType + '\" class=\"filament-select-css\">\\\n\t\t\t\t\t\t\t\t\t<option value=\"cd4f750b-85f8-41f8-b193-9c82e23f82eb\" selected=\"selected\">Office</option>\\\n\t\t\t\t\t\t\t\t\t<option value=\"0ad94cf7-955c-45dc-b49e-20be0f449b75\">Home Office</option>\\\n\t\t\t\t\t\t\t\t</select>\\\n\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t<div id=\"' + idMain + '\">\\\n\t\t\t\t\t\t\t\t<div id=\"' + idInput + '\" contenteditable=\"true\">\\\n\t\t\t\t\t\t\t\t\t&#xfeff;\\\n\t\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t\t<div id=\"' + idLoader + '\">\\\n\t\t\t\t\t\t\t\t\t<div class=\"spin-wrapper\">\\\n\t\t\t\t\t\t\t\t\t\t<div class=\"spinner\">\\\n\t\t\t\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t\t<div id=\"' + idFooter + '\">\\\n\t\t\t\t\t\t\t\t<button id=\"' + idButtonBook + '\" class=\"pure-material-button-contained\">Book</button>\\\n\t\t\t\t\t\t\t\t<button id=\"' + idButtonClear + '\" class=\"pure-material-button-outlined\">Clear</button>\\\n\t\t\t\t\t\t\t\t<button id=\"' + idButtonClose + '\" class=\"pure-material-button-outlined\">Close</button>\\\n\t\t\t\t\t\t\t</div>\\\n\t\t\t\t\t\t</div>\\\n\t\t\t\t\t</div>';\n\t\t\t\tdocument.body.appendChild(dummy.querySelector('div'));\n\n\t\t\t\tsetTimeout(function () { // must be deferred, https://stackoverflow.com/questions/18509507/why-use-settimeout-in-deferred\n\t\t\t\t\tdocument.getElementById(idInput).focus();\n\t\t\t\t}, 0);\n\n\t\t\t\t// document.getElementById(idInput).addEventListener('paste', function (e) { // https://stackoverflow.com/questions/21257688/paste-rich-text-into-content-editable-div-and-only-keep-bold-and-italics-formatt\n\t\t\t\t// \te.preventDefault();\n\t\t\t\t// \tconst clipboardData = e.clipboardData;\n\t\t\t\t// \tconst dataText = clipboardData.getData('text/plain');\n\t\t\t\t// \tif (dataText && dataText.trim().length != 0) {\n\t\t\t\t// \t\tdocument.getElementById(idInput).innerText = dataText;\n\t\t\t\t// \t\treturn false; // prevent returning text in clipboard\n\t\t\t\t// \t}\n\t\t\t\t// }, false);\n\t\t\t\t//\n\t\t\t\t// ...this is good, but the following is better...\n\t\t\t\t//\n\t\t\t\tdocument.getElementById(idInput).addEventListener('paste', function (e) { // https://stackoverflow.com/questions/12027137/javascript-trick-for-paste-as-plain-text-in-execcommand/19327995#19327995\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst content = ((e as any).originalEvent || e).clipboardData.getData('text/plain');\n\t\t\t\t\tdocument.execCommand('insertText', false, content);\n\t\t\t\t});\n\n\t\t\t\tdocument.getElementById(idButtonBook)\n\t\t\t\t\t.onclick = function () {\n\t\t\t\t\t\tconst input = document.getElementById(idInput);\n\n\t\t\t\t\t\t// remove all html except line breaks\n\t\t\t\t\t\tinput.querySelectorAll('span').forEach(function (span) { // also: ... .forEach(span => { ...\n\t\t\t\t\t\t\tinput.removeChild(span);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst string = input.innerText; // or https://developer.mozilla.org/de/docs/Web/API/Node/textContent but textContent ignores line breaks\n\t\t\t\t\t\tif (string.trim().length === 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction setEnabled(isEnabled) {\n\t\t\t\t\t\t\t[idButtonBook, idButtonClear, idButtonClose].forEach(function (id) {\n                (document.getElementById(id) as any).disabled = !isEnabled;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tinput.contentEditable = isEnabled;\n\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\tdocument.getElementById(idLoader).style.visibility = isEnabled ? 'hidden' : 'visible';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetEnabled(false);\n\n\t\t\t\t\t\tconst selectType = document.getElementById(idSelectType);\n\t\t\t\t\t\tconst timesheetTypeUuid = (selectType as any).options[(selectType as any).selectedIndex].value;\n\n\t\t\t\t\t\tinput.innerHTML = '';\n\t\t\t\t\t\tlet linePrevious;\n\n\t\t\t\t\t\tconst lineArray = string.split(/\\r\\n|\\r|\\n/g); // also string.split(/\\r?\\n/g); but mind: https://stackoverflow.com/questions/21711768/split-string-in-javascript-and-detect-line-break/21712066#21712066\n\t\t\t\t\t\t// lineArray.forEach(function (line) { ...\n\t\t\t\t\t\t// the whole booking process has to be done sequential via synchronous xhr (xhr is parallel/async by default),\n\t\t\t\t\t\t// so caches can work, AND most importantly no duplicate entities are created\n\t\t\t\t\t\t// but synchronous xhr should be used in workers exclusively: https://xhr.spec.whatwg.org/#synchronous-flag\n\t\t\t\t\t\t// ...thus forEach cannot be used\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// \"Synchronous XMLHttpRequest outside of workers is in the process of being removed from the web platform\n\t\t\t\t\t\t// as it has detrimental effects to the end user’s experience. (This is a long process that takes many years.)\n\t\t\t\t\t\t// Developers must not pass false for the async argument when current global object is a Window object.\n\t\t\t\t\t\t// User agents are strongly encouraged to warn about such usage in developer tools\n\t\t\t\t\t\t// and may experiment with throwing an \"InvalidAccessError\" DOMException when it occurs.\"\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// ...thus let's simulate synchronours xhr with a mutex callback... https://www.mkyong.com/java/java-thread-mutex-and-semaphore-example/\n\t\t\t\t\t\tconst synchronizedLineProcessor = function (statusOfPreviousLine?: any) {\n\t\t\t\t\t\t\tif (linePrevious) {\n\t\t\t\t\t\t\t\tinput.innerHTML =\n\t\t\t\t\t\t\t\t\t(input.innerHTML\n\t\t\t\t\t\t\t\t\t\t? input.innerHTML + '<br>'\n\t\t\t\t\t\t\t\t\t\t: '')\n\t\t\t\t\t\t\t\t\t+ (statusOfPreviousLine\n\t\t\t\t\t\t\t\t\t\t? '<span class=\"pill\" style=\"background-color: ' + (statusOfPreviousLine === statusOfPreviousLineDone ? 'green' : 'red') + ';\">' + statusOfPreviousLine + '</span>'\n\t\t\t\t\t\t\t\t\t\t: '')\n\t\t\t\t\t\t\t\t\t+ linePrevious;\n\t\t\t\t\t\t\t\tinput.scrollTop = input.scrollHeight; // https://stackoverflow.com/questions/40495860/how-to-scroll-to-automatically-scroll-to-the-bottom-of-an-editable-div-onload/40506676#40506676\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (lineArray.length > 0) {\n\t\t\t\t\t\t\t\tlinePrevious = lineArray.shift(); // https://love2dev.com/blog/javascript-remove-from-array/\n\t\t\t\t\t\t\t\tcheckLineAndParseProperties(linePrevious, timesheetTypeUuid, synchronizedLineProcessor); // first step, forwards to consecutive steps\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetEnabled(true);\n\t\t\t\t\t\t\t\tconst refreshButton = document.querySelector('button\\[ng-click=\"refresh\\(\\)\"\\]');\n\t\t\t\t\t\t\t\tif (refreshButton) {\n                  (refreshButton as any).click();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTimeout(function () { // must be deferred\n\t\t\t\t\t\t\tsynchronizedLineProcessor();\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t};\n\n\t\t\t\tdocument.getElementById(idButtonClear)\n\t\t\t\t\t.onclick = function () { // https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick\n\t\t\t\t\t\tconst input = document.getElementById(idInput);\n\t\t\t\t\t\tinput.innerHTML = ''; // https://stackoverflow.com/questions/3450593/how-do-i-clear-the-content-of-a-div-using-javascript\n\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t};\n\n\t\t\t\tdocument.getElementById(idButtonClose)\n\t\t\t\t\t.onclick = function () {\n\t\t\t\t\t\tclear();\n\t\t\t\t\t};\n\n\t\t\t\tdocument.onkeydown = function (event: any) {\n\t\t\t\t\tevent = event || window.event;\n\t\t\t\t\tif (event.keyCode == 27) { // ESC key\n\t\t\t\t\t\tclear();\n\t\t\t\t\t\tdocument.onkeydown = undefined; // deregister\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow['COM_KAMILSARELO_DYNATRACE_TIMETRACKING_FORK_RUNNING'] = false;\n\t\t\t});\n\t};\n\n\tfunction checkLineAndParseProperties(line, timesheetTypeUuid, callback) {\n\t\tline = line.trim();\n\t\tif (!line) {\n\t\t\tcallback(); // no error on empty line\n\t\t\treturn;\n\t\t}\n\n\t\tconst properties = (function () { //anonymous function in order to use \"return\" and no need to deferred call of callback before each return\n\t\t\t// basic sanity checks:\n\t\t\t// 2019-03-11|12:00|16:00|...|...\n\t\t\t// 0123456789 123456789 123456789\n\t\t\tif (!line // not: null undefined NaN \"\" 0 false: https://stackoverflow.com/questions/5515310/is-there-a-standard-function-to-check-for-null-undefined-or-blank-variables-in/5515349#5515349\n\t\t\t\t|| line.length <= 23 // first 23 characters are fixed width: date, time, time\n\t\t\t\t|| isNaN(line.charAt(0)) // first character must be a number: https://stackoverflow.com/questions/8935632/check-if-character-is-number\n\t\t\t\t|| '|' !== line.charAt(10)\n\t\t\t\t|| '|' !== line.charAt(16)\n\t\t\t\t|| '|' !== line.charAt(22)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// date and times\n\t\t\tconst stringDate = line.substr(0, 10); // https://www.w3schools.com/jsref/jsref_obj_string.asp\n\t\t\tconst stringTimeBegin = line.substr(11, 5);\n\t\t\tconst stringTimeEnd = line.substr(17, 5);\n\t\t\t// Jira key\n\t\t\tconst indexOfPipe = line.indexOf('|', 23);\n\t\t\tif (indexOfPipe === -1) { // no delimiter after Jira key\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst stringJiraKey = line.substring(23, indexOfPipe); // https://stackoverflow.com/questions/2243824/what-is-the-difference-between-string-slice-and-string-substring\n\t\t\tif (stringJiraKey === '') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// comment\n\t\t\tconst stringComment = line.substr(indexOfPipe + 1);\n\t\t\tif (stringComment === '') { // empty comment\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t{ // date sanity checks\n\t\t\t\t// valid delimiters\n\t\t\t\tif ('-' !== stringDate.charAt(4) || '-' !== stringDate.charAt(7)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid digits: https://stackoverflow.com/questions/175739/built-in-way-in-javascript-to-check-if-a-string-is-a-valid-number\n\t\t\t\tif (isNaN(stringDate.charAt(0)) || isNaN(stringDate.charAt(1)) || isNaN(stringDate.charAt(2)) || isNaN(stringDate.charAt(3))\n\t\t\t\t\t|| isNaN(stringDate.charAt(5)) || isNaN(stringDate.charAt(6))\n\t\t\t\t\t|| isNaN(stringDate.charAt(8)) || isNaN(stringDate.charAt(9))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid year\n\t\t\t\tconst integerYearCurrent = new Date().getFullYear();\n\t\t\t\tconst integerYear = parseInt(stringDate.substr(0, 4), 10);\n\t\t\t\t// if (isNaN(integerYear) || integerYear < 2019 || integerYear > 2046) {\n\t\t\t\tif (isNaN(integerYear) || integerYear < integerYearCurrent || integerYear > integerYearCurrent) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid month\n\t\t\t\tconst integerMonth = parseInt(stringDate.substr(5, 2), 10);\n\t\t\t\tif (isNaN(integerYear) || integerMonth < 1 || integerMonth > 12) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid day\n\t\t\t\tconst integerDay = parseInt(stringDate.substr(8, 2), 10);\n\t\t\t\tif (isNaN(integerYear) || integerDay < 1 || integerDay > 31) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid date\n\t\t\t\tif ((function () {\n\t\t\t\t\tconst date = new Date();\n\t\t\t\t\tdate.setFullYear(integerYear, integerMonth - 1, integerDay);\n\t\t\t\t\treturn date.getFullYear() !== integerYear || date.getMonth() !== integerMonth - 1 || date.getDate() !== integerDay; // https://ctrlq.org/code/20109-javascript-date-valid\n\t\t\t\t})()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t{ // time sanity checks\n\t\t\t\tfunction isInvaliDigit(stringTime) {\n\t\t\t\t\treturn isNaN(stringTime.charAt(0)) || isNaN(stringTime.charAt(1)) || isNaN(stringTime.charAt(3)) || isNaN(stringTime.charAt(4));\n\t\t\t\t}\n\t\t\t\tfunction isInvalidHour(integerHour) {\n\t\t\t\t\treturn isNaN(integerHour) || integerHour < 0 || integerHour > 23;\n\t\t\t\t}\n\t\t\t\tfunction isInvalidMinute(integerMinute) {\n\t\t\t\t\treturn isNaN(integerMinute) || integerMinute < 0 || integerMinute > 59;\n\t\t\t\t}\n\t\t\t\t// valid delimiters\n\t\t\t\tif (':' !== stringTimeBegin.charAt(2) || ':' !== stringTimeEnd.charAt(2)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid digits\n\t\t\t\tif (isInvaliDigit(stringTimeBegin) || isInvaliDigit(stringTimeEnd)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid hours\n\t\t\t\tconst integerHourBegin = parseInt(stringTimeBegin.substr(0, 2), 10);\n\t\t\t\tconst integerHourEnd = parseInt(stringTimeEnd.substr(0, 2), 10);\n\t\t\t\tif (isInvalidHour(integerHourBegin) || isInvalidHour(integerHourEnd)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// valid minutes\n\t\t\t\tconst integerMinuteBegin = parseInt(stringTimeBegin.substr(3, 2), 10);\n\t\t\t\tconst integerMinuteEnd = parseInt(stringTimeEnd.substr(3, 2), 10);\n\t\t\t\tif (isInvalidMinute(integerMinuteBegin) || isInvalidMinute(integerMinuteEnd)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// begin actually before end\n\t\t\t\tif (integerHourBegin > integerHourEnd\n\t\t\t\t\t|| integerHourBegin === integerHourEnd && integerMinuteBegin >= integerMinuteEnd) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst APP_BeginTime = stringDate + 'T' + stringTimeBegin + ':00';\n\t\t\tconst APP_EndTime = stringDate + 'T' + stringTimeEnd + ':00';\n\t\t\t// const APP_Description = encodeURIComponent(stringComment); // encoding not necessary, https://stackoverflow.com/questions/332872/encode-url-in-javascript/6171234#6171234\n\t\t\tconst APP_Description = stringComment;\n\n\t\t\treturn { // https://stackoverflow.com/questions/12272239/javascript-function-returning-an-object\n\t\t\t\tjiraKey: stringJiraKey,\n\t\t\t\tAPP_BeginTime: APP_BeginTime,\n\t\t\t\tAPP_EndTime: APP_EndTime,\n\t\t\t\tAPP_Description: APP_Description\n\t\t\t};\n\t\t})();\n\t\tif (properties) {\n\t\t\tproperties['USR_TimesheetTypeUuid'] = timesheetTypeUuid;\n\n\t\t\t// console.log('properties');\n\t\t\t// console.log('  jiraKey               = ' + properties.jiraKey);\n\t\t\t// console.log('  APP_BeginTime         = ' + properties.APP_BeginTime);\n\t\t\t// console.log('  APP_EndTime           = ' + properties.APP_EndTime);\n\t\t\t// console.log('  APP_Description       = ' + properties.APP_Description);\n\t\t\t// console.log('  USR_TimesheetTypeUuid = ' + properties.USR_TimesheetTypeUuid);\n\n\t\t\tqueryUserId(properties, callback);\n\t\t} else {\n\t\t\tcallback('invalid');\n\t\t}\n\t};\n\n\tfunction queryUserId(properties, callback) {\n\t\tfunction nextStep() {\n\t\t\tproperties.APP_UserDetailUuid = cacheUserDetailUuid;\n\t\t\t// console.log('APP_UserDetailUuid = ' + properties.APP_UserDetailUuid);\n\n\t\t\tcheckIfEntityWithEqualBeginOrEndTimeAlreadyExists(properties, callback);\n\t\t}\n\t\tif (cacheUserDetailUuid) {\n\t\t\tnextStep(); // not deferred, because async xhr starts immediately in next step\n\t\t\treturn; // avoid running callback too early\n\t\t}\n\t\txhrGet('/shell/user')\n\t\t\t.then(function (response: string) {\n\t\t\t\t// console.log(response);\n\t\t\t\tconst json = JSON.parse(response);\n\t\t\t\tif (json) {\n\t\t\t\t\tif (json.useruuid) {\n\t\t\t\t\t\tcacheUserDetailUuid = json.useruuid;\n\t\t\t\t\t\tnextStep();\n\t\t\t\t\t\treturn; // avoid running callback too early\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('ERROR: no useruuid available');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('ERROR: on JSON.parse() in queryUserId()');\n\t\t\t\t}\n\t\t\t\tcallback('error');\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tconsole.log('ERROR: in queryUserId()', error);\n\t\t\t\tcallback(error.status || 'error');\n\t\t\t});\n\t\t;\n\t}\n\n\tfunction checkIfEntityWithEqualBeginOrEndTimeAlreadyExists(properties, callback) {\n\t\txhrGet('/odata/APP_Timesheet'\n\t\t\t+ '?$filter=(APP_BeginTime eq datetime\\'' + properties.APP_BeginTime + '\\''\n\t\t\t+ ' or APP_EndTime eq datetime\\'' + properties.APP_EndTime + '\\')'\n\t\t\t+ ' and APP_UserDetailUuid eq guid\\'' + properties.APP_UserDetailUuid + '\\'')\n\t\t\t.then(function (response) {\n\t\t\t\t// console.log(response);\n\t\t\t\tconst json = JSON.parse(response);\n\t\t\t\tif (json && json.value) {\n\t\t\t\t\tif (json.value.length > 0) {\n\t\t\t\t\t\tconsole.log('ERROR: APP_Timesheet entity with equal start- (' + properties.APP_BeginTime + ') and/or end-time (' + properties.APP_EndTime + ') exists');\n\t\t\t\t\t\tcallback('exists');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqueryTaskIdAndProjectIdForJiraKey(properties, callback);\n\t\t\t\t\t\treturn; // avoid running callback too early\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('ERROR: on JSON.parse() in checkIfEntityWithEqualBeginOrEndTimeAlreadyExists()');\n\t\t\t\t}\n\t\t\t\tcallback('error');\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tconsole.log('ERROR: in checkIfEntityWithEqualBeginOrEndTimeAlreadyExists()', error);\n\t\t\t\tcallback(error.status || 'error');\n\t\t\t})\n\t}\n\n\tfunction queryTaskIdAndProjectIdForJiraKey(properties, callback) {\n\t\tfunction nextStep() {\n\t\t\tconst cache = cacheTaskIdAndProjectId.get(properties.jiraKey);\n\t\t\tproperties.APP_TaskUuid = cache.APP_TaskUuid;\n\t\t\tproperties.APP_ProjectUuid = cache.APP_ProjectUuid;\n\n\t\t\t// console.log('  APP_TaskUuid          = ' + properties.APP_TaskUuid);\n\t\t\t// console.log('  APP_ProjectUuid       = ' + properties.APP_ProjectUuid);\n\n\t\t\tcreateEntity(properties, callback);\n\t\t}\n\t\tif (cacheTaskIdAndProjectId.has(properties.jiraKey)) {\n\t\t\tnextStep(); // not deferred, because async xhr starts immediately in next step\n\t\t\treturn; // avoid running callback too early\n\t\t}\n\t\txhrGet('/odata/APP_Task'\n\t\t\t+ '?$filter=APP_Code eq \\'' + properties.jiraKey + '\\''\n\t\t\t+ '&$select=APP_TaskUuid,APP_ProjectUuid')\n\t\t\t.then(function (response) {\n\t\t\t\tconst json = JSON.parse(response); // https://stackoverflow.com/questions/33169315/json-parse-selecting-from-a-select-container\n\t\t\t\tif (json && json.value) {\n\t\t\t\t\tif (json.value.length > 0) {\n\t\t\t\t\t\tcacheTaskIdAndProjectId.set(properties.jiraKey, {\n\t\t\t\t\t\t\tAPP_TaskUuid: json.value[0].APP_TaskUuid,\n\t\t\t\t\t\t\tAPP_ProjectUuid: json.value[0].APP_ProjectUuid\n\t\t\t\t\t\t});\n\t\t\t\t\t\tnextStep();\n\t\t\t\t\t\treturn; // avoid running callback too early\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('ERROR: no APP_Task entity for specified Jira key (' + properties.jiraKey + ') available');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('ERROR: on JSON.parse() in queryTaskIdAndProjectIdForJiraKey()');\n\t\t\t\t}\n\t\t\t\tcallback('error');\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tconsole.log('ERROR: in queryTaskIdAndProjectIdForJiraKey()', error);\n\t\t\t\tcallback(error.status || 'error');\n\t\t\t});\n\t}\n\n\tfunction createEntity(properties, callback) {\n\t\tconst json = JSON.stringify({\n\t\t\t// 'APP_TimesheetUuid': https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript/2117523#2117523\n\t\t\t'APP_BeginTime': properties.APP_BeginTime,\n\t\t\t'APP_EndTime': properties.APP_EndTime,\n\t\t\t'APP_Description': properties.APP_Description,\n\t\t\t'APP_TaskUuid': properties.APP_TaskUuid,\n\t\t\t'APP_ProjectUuid': properties.APP_ProjectUuid,\n\t\t\t'APP_UserDetailUuid': properties.APP_UserDetailUuid,\n\t\t\t'USR_TimesheetTypeUuid': properties.USR_TimesheetTypeUuid,\n\t\t\t// 'APP_IsDurationTimesheet': false,\n\t\t\t// 'APP_NoBilling': false,\n\t\t\t// 'USR_MedicalConfirmationReceived': false\n\t\t});\n\t\txhrPost('/odata/APP_Timesheet', json)\n\t\t\t.then(function (response) {\n\t\t\t\t// console.log('booked');\n\t\t\t\tcallback(statusOfPreviousLineDone);\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tconsole.log('ERROR: in createEntity()', error);\n\t\t\t\tcallback(error.status || 'error');\n\t\t\t})\n\t}\n\n\tfunction deleteEntity(APP_TimesheetUuid) {\n\t\txhrDelete('/odata/APP_Timesheet(guid\\'' + APP_TimesheetUuid + '\\')')\n\t\t\t.then(function (response) {\n\t\t\t\tconsole.log('deleted APP_Timesheet entity with UUID: ' + APP_TimesheetUuid);\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tconsole.log('ERROR: in deleteEntity()', error);\n\t\t\t});\n\n\t}\n\n\tfunction xhrGet(url): Promise<string> {\n\t\treturn xhr(url);\n\t};\n\n\tfunction xhrPost(url, json): Promise<string> {\n\t\treturn xhr(url, 'POST', json);\n\t};\n\n\tfunction xhrDelete(url): Promise<string> {\n\t\treturn xhr(url, 'DELETE');\n\t};\n\n\tfunction xhr(url, method?, json?): Promise<string> {\n\t\tconst request = new XMLHttpRequest();\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\trequest.onreadystatechange = function () {\n\t\t\t\tif (request.readyState !== 4) return; // 4 is DONE, https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\n\t\t\t\tif (request.status >= 200 && request.status < 300) {\n\t\t\t\t\t// console.dir(request);\n\t\t\t\t\t// console.log(response);\n\t\t\t\t\t// resolve(request);\n\t\t\t\t\tresolve(request.responseText);\n\t\t\t\t} else {\n\t\t\t\t\treject({\n\t\t\t\t\t\tstatus: request.status,\n\t\t\t\t\t\tstatusText: request.statusText\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\trequest.open(method || 'GET', url, true);\n\t\t\trequest.setRequestHeader('cache-control', 'no-cache'); // https://stackoverflow.com/a/48969579\n\t\t\trequest.setRequestHeader('cache-control', 'max-age=0');\n\t\t\trequest.setRequestHeader('pragma', 'no-cache');\n\t\t\tif (method === 'POST') { // if (json) {\n\t\t\t\trequest.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n\t\t\t\trequest.send(json);\n\t\t\t} else {\n\t\t\t\trequest.send();\n\t\t\t}\n\t\t});\n\t};\n\n\treturn methods;\n})();\n\nmain();\n"],"sourceRoot":""}